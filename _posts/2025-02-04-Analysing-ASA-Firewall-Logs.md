# **Analysing ASA Firewall Logs: A Beginner’s Approach**

Analysing firewall logs is an essential skill for any cybersecurity professional, helping to identify and investigate potential threats and network anomalies. In this writeup, I will be analysing ASA firewall logs generated by Cisco firewalls. While I am still learning the best practices for log analysis, this writeup aims to provide insights for those new to investigating logs (like me) and serve as a learning experience. 
If you want to follow along, you can clone the following [GitHub repository](https://github.com/strandjs/IntroLabs):

```bash
git clone https://github.com/strandjs/IntroLabs/
```

Within the IntroLabs directory, there is a file named ASA-syslogs.txt, which contains the ASA firewall logs we will be investigating. This lab is largely inspired by the Antisyphon training classes, which offer excellent and accessible cybersecurity training. I highly recommend exploring their labs for further learning.

<br>

### **Why Not Just Use Cat?**

Most people might start by dumping the logs using the cat utility:

<img width="602" height="76" alt="Image" src="https://github.com/user-attachments/assets/9fc56be3-ed70-4060-9a79-3728bd9d5aca" />

However, given the large volume of logs, this approach is inefficient. Instead, we can leverage command-line utilities like grep, cut, uniq, and sort to filter and analyse the data efficiently. 

<br>

### **Filtering Logs More Efficiently**

To reduce unnecessary entries, we can exclude logs related to a known local gateway (e.g., 24.230.56.6) using the grep command:

```bash
cat ASA-syslogs.txt | wc -l 
```

<img width="533" height="95" alt="Image" src="https://github.com/user-attachments/assets/347f5da2-8de7-4881-ac1b-ce0635e34a99" />


Vs:


```bash
cat ASA-syslogs.txt | grep -v 24.230.56.6 | wc -l 
```

<img width="677" height="103" alt="Image" src="https://github.com/user-attachments/assets/7e3d5187-1878-4b47-9708-15ddb39829eb" />

As you can see, this dramatically reduces the number of logs we need to investigate. 

<br>

### **Analysing Connection Closures** 

We can further refine our results by extracting specific fields from the logs. Here, we will use the cut command to help extract specific columns that we want to see:

```bash
cat ASA-syslogs.txt | grep -v 24.230.56.6 | grep FIN | cut -d ' ' -f 1,3,4,5,7,8,9,10,11,12,13,14
```

- -d specifies what the delimiter is, in this case a space is what separates different columns/field values. If we were investigating a csv file via the command line, the delimiter would be a comma. 
- -f specifies what fields/columns we want to extract. 

<img width="940" height="335" alt="Image" src="https://github.com/user-attachments/assets/2feb0b75-5a0a-4dc5-8d09-00bc2d767912" />

<br>

### **Identifying Suspicious IPs**

The output of the previous command still results in numerous logs, just in a neater format. Why don’t we count the number of closed connections per IP address to see if there’s anything interesting:

```bash
cat ASA-syslogs.txt | grep -v 24.230.56.6 | grep FIN | cut -d ' ' -f 8 | sort | uniq -c | sort -nr
```

This command:
- Excludes logs related to the local gateway
- Filters for finished connections (FIN flag set)
- Extract the 8th field/column
- Counts the number of uniq occurrences in the 8th column, and
- Sorts numerically and in reverse so we can see the highest count first

<img width="403" height="305" alt="Image" src="https://github.com/user-attachments/assets/960b6d48-8b8b-498f-8c1f-721bb1603217" />

<br>

## **Interpreting Findings**

As we can see from the output of the previous command, there are thousands of connections from 18.160.185.174 and 13.107.237.38. This merits a deeper investigation, and a simple first step would be to look for logs generated by these IP addresses and inspect them further, for example:

<img width="940" height="266" alt="Image" src="https://github.com/user-attachments/assets/dddfe521-e1e2-448c-8cd3-74e473df0d6c" />

We can see consistent and short connection durations and the number of bytes is also very consistent. Based on the ports used, we can likely conclude that the internal host is making a series of requests to a web server at 18.160.185.174 over HTTPS, possibly indicating data exfiltration or C2 activity. 

<br>

### **Conclusion**

This writeup provided an introduction to analysing ASA firewall logs using command-line tools. By filtering unnecessary data, extracting relevant fields, and identifying high-frequency connections, we can begin to identify potential incidents. To learn more about log analysis, I recommend exploring Antisyphon’s training resources. 
Would love to hear your thoughts and feedback! Feel free to reach out.

